<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FARMesilla | Catering Services | Mesilla, NM</title>
<script src="https://cdn.tailwindcss.com"></script>
<script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#f5e7d0',
            primary2: '#e8d9c0',
            secondary: '#33251e',
            w: '#fff',
            b: '#000',
            accent: '#432f25'
          },
          fontFamily: {
            title: ['"Bernard MT Condensed"', 'serif'],
            body: ['"Adabi MT Light"', 'sans-serif']
          }
        }
      }
    }
</script>

<link href="https://db.onlinewebfonts.com/c/a552118ceee33dff8a6acab5d1c10b60?family=Bernard+MT+Condensed+V1" rel="stylesheet">
<link href="https://db.onlinewebfonts.com/c/0828325a5d135368bf470ed1f2e68d63?family=Abadi+MT+Std+Light" rel="stylesheet">

<style>
    /* Bernard MT Condensed */
@font-face {
  font-family: 'Bernard MT Condensed';
  src: url('https://db.onlinewebfonts.com/t/a552118ceee33dff8a6acab5d1c10b60.eot');
  src: url('https://db.onlinewebfonts.com/t/a552118ceee33dff8a6acab5d1c10b60.eot?#iefix') format('embedded-opentype'),
       url('https://db.onlinewebfonts.com/t/a552118ceee33dff8a6acab5d1c10b60.woff2') format('woff2'),
       url('https://db.onlinewebfonts.com/t/a552118ceee33dff8a6acab5d1c10b60.woff') format('woff'),
       url('https://db.onlinewebfonts.com/t/a552118ceee33dff8a6acab5d1c10b60.ttf') format('truetype'),
       url('https://db.onlinewebfonts.com/t/a552118ceee33dff8a6acab5d1c10b60.svg#Bernard MT Condensed V1') format('svg');
  font-style: normal;
  font-display: swap;
}

/* Abadi MT Light */
@font-face {
  font-family: 'Abadi MT Std Light';
  src: url('https://db.onlinewebfonts.com/t/0828325c...63.eot');
  src: url('https://db.onlinewebfonts.com/t/0828325c...63.eot?#iefix') format('embedded-opentype'),
       url('https://db.onlinewebfonts.com/t/0828325c...63.woff2') format('woff2'),
       url('https://db.onlinewebfonts.com/t/0828325c...63.woff') format('woff'),
       url('https://db.onlinewebfonts.com/t/0828325c...63.ttf') format('truetype'),
       url('https://db.onlinewebfonts.com/t/0828325c...63.svg#Abadi MT Std Light') format('svg');
  font-style: normal;
  font-display: swap;
}
body {
  background-color: #f5e7d0;
  background-image: url('https://www.transparenttextures.com/patterns/soft-wallpaper.png');
  background-repeat: repeat;
  background-size: auto;
  position: relative;
}

body::before {
  content: "";
  position: fixed;
  top: 0; left: 0; right: 0; bottom: 0;
  background-image: url('https://www.transparenttextures.com/patterns/soft-wallpaper.png');
  opacity: 0.1;
  pointer-events: none;
  z-index: 0;
}

body {
  font-family: 'Adabi MT Light', sans-serif;
  letter-spacing: 0.02em;
}

h1, h2, h3, h4, p1 {
  font-family: 'Bernard MT Condensed', serif;
  font-weight: 500;
  letter-spacing: 0.05em;
  text-transform: uppercase;
}

.section-content {
  position: relative;
  z-index: 2;
}

.menu-item-image {
  width: 96px;
  height: 96px;
  object-fit: cover;
  border-radius: 8px;
  border: 2px solid #c8b697;
}

.modal-overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.5);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1000;
}

.modal-content {
  background: white;
  border-radius: 8px;
  padding: 2rem;
  max-width: 90vw;
  max-height: 90vh;
  overflow-y: auto;
  position: relative;
}

.close-btn {
  position: absolute;
  top: 1rem;
  right: 1rem;
  background: none;
  border: none;
  font-size: 1.5rem;
  cursor: pointer;
}

.hidden { display: none; }

.editable-item {
  border: 1px solid #e5e7eb;
  border-radius: 8px;
  padding: 1rem;
  margin-bottom: 1rem;
  background: #f9fafb;
}

.edit-form input, .edit-form textarea, .edit-form select {
  width: 100%;
  padding: 0.5rem;
  border: 1px solid #d1d5db;
  border-radius: 4px;
  margin-bottom: 0.5rem;
}

.save-btn, .edit-btn, .delete-btn, .cancel-btn {
  padding: 0.5rem 1rem;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  margin-right: 0.5rem;
  margin-bottom: 0.5rem;
}

.save-btn { background: #10b981; color: white; }
.edit-btn { background: #3b82f6; color: white; }
.delete-btn { background: #ef4444; color: white; }
.cancel-btn { background: #6b7280; color: white; }

.collapsible-content {
  transition: max-height 0.3s ease-out;
  overflow: hidden;
}

.toggle-arrow {
  display: inline-block;
  transition: transform 0.3s ease;
}
</style>
</head>

<nav class="bg-b top-0 z-50 shadow-md">
    <div class="container mx-auto px-4 sm:px-6 py-3 md:py-4">
        <div class="flex items-center justify-between">
            <!-- Logo/Brand and Homepage Button -->
            <div class="flex items-center space-x-4">
                <a href="#" class="flex items-center">
                    <img src="assets/f2g.png" alt="FARMesilla" class="h-28 md:h-28">
                </a>



            </div>

            <!-- Desktop Navigation (without Homepage button) -->
            <div class="hidden md:flex items-center space-x-8">
                <a href="about.html" class="text-primary text-sm md:text-base tracking-wider hover:text-accent transition duration-300 font-title">ABOUT US</a>
                <a href="index.html#contact" class="text-primary text-sm md:text-base tracking-wider hover:text-accent transition duration-300 font-title">CONTACT US</a>
                        <a href="index.html" class="hidden md:inline-block bg-primary text-secondary px-4 py-2 rounded-full hover:text-primary hover:bg-accent transition duration-300 text-sm tracking-wider font-title">
  HOMEPAGE
</a>
                <!-- Account Icon -->
                <button id="account-btn" class="text-primary hover:text-accent transition duration-300 p-2">
                    <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                    </svg>
                </button>
            </div>

            <!-- Mobile menu button -->
            <div class="md:hidden flex items-center space-x-4">
                <!-- Mobile Account Icon -->
                <button id="mobile-account-btn" class="text-primary hover:text-accent transition duration-300 p-2">
                    <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                    </svg>
                </button>
                
                <button type="button" class="mobile-menu-button text-primary focus:outline-none">
                    <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                    </svg>
                </button>
            </div>
        </div>

        <!-- Mobile menu (without Homepage button) -->
        <div class="mobile-menu hidden md:hidden pt-4 pb-2">
            <div class="flex flex-col items-center justify-center space-y-3 text-center">
                <a href="about.html" class="block px-3 py-2 hover:text-accent text-primary text-sm tracking-wider font-title">ABOUT US</a>
                <a href="index.html#contact" class="block px-3 py-2 hover:text-accent text-primary text-sm tracking-wider font-title">CONTACT US</a>
                <a href="index.html" class="bg-primary text-secondary px-4 py-2 rounded-full hover:text-primary hover:bg-accent transition duration-300 text-sm tracking-wider font-title">HOMEPAGE</a>
            </div>
        </div>
    </div>
</nav>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const accountModal = document.getElementById('account-modal');
        const body = document.body;
        
        function toggleBodyScroll(enable) {
            if (enable) {
                body.style.overflow = '';
                body.style.position = '';
                body.style.height = '';
                body.style.width = '';
            } else {
                body.style.overflow = 'hidden';
                body.style.position = 'fixed';
                body.style.height = '100%';
                body.style.width = '100%';
            }
        }
        
        document.getElementById('account-btn').addEventListener('click', function() {
            toggleBodyScroll(false);
        });
        
        document.getElementById('mobile-account-btn').addEventListener('click', function() {
            toggleBodyScroll(false);
        });
        
        document.getElementById('close-modal').addEventListener('click', function() {
            toggleBodyScroll(true);
        });
        
        accountModal.addEventListener('click', function(e) {
            if (e.target === accountModal) {
                toggleBodyScroll(true);
            }
        });
    });
</script>

<!-- Account/Dashboard Modal - Updated Version -->
<div id="account-modal" class="fixed inset-0 bg-black/50 z-50 hidden overflow-hidden">
    <div class="flex items-start justify-center min-h-screen p-4 pt-20">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-4xl max-h-[80vh] md:max-h-[90vh] flex flex-col">
            <div class="flex justify-between items-center p-6 border-b border-gray-200 sticky top-0 bg-white z-10">
                <p class="text-2xl font-medium text-gray-900">Chef Login</p>
                <button id="close-modal" class="text-gray-400 hover:text-gray-600 text-2xl">&times;</button>
            </div>
            
            <!-- Content Area with Scroll -->
            <div class="flex-1 overflow-y-auto">
                <!-- Auth Section -->
                <div id="auth-section" class="p-6">
                    <div class="max-w-md mx-auto">
                        <!-- Login Form Only -->
                        <div class="bg-gray-50 p-6 rounded-lg">
                            <h3 class="text-lg font-semibold mb-4 text-gray-900">Chef Login</h3>
                            <form id="login-form">
                                <input type="email" id="login-email" placeholder="Email" class="w-full p-3 border border-gray-300 rounded-md mb-3 focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                                <input type="password" id="login-password" placeholder="Password" class="w-full p-3 border border-gray-300 rounded-md mb-4 focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                                <button type="submit" class="w-full bg-gray-900 text-white p-3 rounded-md hover:bg-gray-800 transition-colors">Login</button>
                            </form>
                        </div>
                    </div>
                </div>
                
                <!-- Dashboard Section -->
                <div id="dashboard-section" class="hidden">
                    <div class="p-6">
                        <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4">
                            <div class="flex space-x-4 w-full md:w-auto">
                                <button id="add-item-btn" class="bg-black text-white px-4 py-2 md:px-6 md:py-3 rounded-lg hover:bg-gray-800 transition-colors flex items-center w-full md:w-auto justify-center">
                                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                                    </svg>
                                    Add New Item
                                </button>
                            </div>
                            <button id="logout-btn" class="bg-black text-white px-4 py-2 md:px-6 md:py-3 rounded-lg hover:bg-gray-800 transition-colors w-full md:w-auto">Logout</button>
                        </div>
                        
                        <!-- Menu Items - Single Column Layout -->
                        <div id="menu-items-dashboard">
                            <div id="items-list" class="space-y-4">
                                <!-- Items will appear here in single column -->
                                <!-- Example item structure (will be populated dynamically) -->
                                <div class="item-card border rounded-lg p-4 w-full">
                                    <div class="flex justify-between items-start">
                                        <div>
                                            <h3 class="font-medium text-lg">Sample Item</h3>
                                            <p class="text-gray-600">$12.99</p>
                                            <div class="mt-2 flex flex-wrap gap-2">
                                                <span class="bg-gray-100 px-2 py-1 rounded text-xs">Available</span>
                                                <span class="bg-gray-100 px-2 py-1 rounded text-xs">Tortas</span>
                                            </div>
                                        </div>
                                        <div class="flex space-x-2">
                                            <button class="edit-item p-2 text-gray-500 hover:text-blue-600">
                                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                                                </svg>
                                            </button>
                                            <button class="delete-item p-2 text-gray-500 hover:text-red-600">
                                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                                </svg>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Item Form Section -->
                <div id="item-form-section" class="hidden">
                    <div class="p-6">
                        <div class="flex justify-between items-center mb-6">
                            <h3 id="item-form-title" class="text-xl font-medium text-gray-900">Add New Item</h3>
                            <button id="back-to-dashboard" class="text-gray-400 hover:text-gray-600 flex items-center">
                                <svg class="w-5 h-5 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                                </svg>
                                Back to Dashboard
                            </button>
                        </div>
                        
                        <form id="item-form">
                            <div class="grid md:grid-cols-2 gap-6">
                                <!-- Basic Info -->
                                <div class="space-y-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Item Name *</label>
                                        <input type="text" id="item-name" class="w-full p-3 border border-gray-300 rounded-md mb-3 focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                                    </div>
                                    
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Price (for 5 people) *</label>
                                        <input type="number" id="item-price" step="0.01" class="w-full p-3 border border-gray-300 rounded-md mb-4 focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                                    </div>
                                    
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Category *</label>
                                        <div class="space-y-2">
                                            <select id="item-category" class="w-full p-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent" onchange="handleCategoryChange(this)">
                                                <option value="">Select Category</option>
                                                <option value="tortas">Tortas & Wraps</option>
                                                <option value="salads">Salads</option>
                                                <option value="bowls">Bowls</option>
                                                <option value="enchiladas">Enchiladas</option>
                                                <option value="sides">Sides</option>
                                                <option value="desserts">Desserts</option>
                                                <option value="beverages">Beverages</option>
                                                <option value="custom">+ Create New Category</option>
                                            </select>
                                            <input type="text" id="custom-category" placeholder="Enter new category name" class="w-full p-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent hidden">
                                        </div>
                                    </div>
                                    
                                    <!-- Portion Visibility Section -->
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Portion Visibility *</label>
                                        <div class="space-y-2">
                                            <label class="flex items-center">
                                                <input type="checkbox" id="portion-5" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded" checked>
                                                <span class="ml-2 text-sm text-gray-700">Show for 5 people portions</span>
                                            </label>
                                            <label class="flex items-center">
                                                <input type="checkbox" id="portion-10" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                                                <span class="ml-2 text-sm text-gray-700">Show for 10 people portions</span>
                                            </label>
                                            <label class="flex items-center">
                                                <input type="checkbox" id="portion-20" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                                                <span class="ml-2 text-sm text-gray-700">Show for 20 people portions</span>
                                            </label>
                                        </div>
                                    </div>
                                    
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Image URL</label>
                                        <input type="url" id="item-image-url" class="w-full p-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                        <a href="http://nicholasxdavis.github.io/cards-img/index.html" target="_blank" class="inline-block mt-2 text-sm text-blue-600 hover:text-blue-800 underline">
                                            Upload IMGs into URLs here
                                        </a>
                                    </div>
                                    
                                    <div class="flex items-center">
                                        <input type="checkbox" id="item-available" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                                        <label for="item-available" class="ml-2 block text-sm text-gray-700">Available</label>
                                    </div>
                                </div>
                                
                                <!-- Description and Tags -->
                                <div class="space-y-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Description</label>
                                        <textarea id="item-description" rows="3" class="w-full p-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"></textarea>
                                    </div>
                                    
                                    <!-- Dietary Tags -->
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Dietary Tags</label>
                                        <div class="space-y-2">
                                            <label class="flex items-center">
                                                <input type="checkbox" id="tag-gf" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                                                <span class="ml-2 text-sm text-gray-700">Gluten Free (GF)</span>
                                            </label>
                                            <label class="flex items-center">
                                                <input type="checkbox" id="tag-v" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                                                <span class="ml-2 text-sm text-gray-700">Vegan (V)</span>
                                            </label>
                                            <label class="flex items-center">
                                                <input type="checkbox" id="tag-n" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                                                <span class="ml-2 text-sm text-gray-700">Contains Nuts (N)</span>
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Add-ons Section -->
                            <div class="mt-6 border-t pt-6">
                                <div class="flex justify-between items-center mb-4">
                                    <h4 class="text-lg font-medium text-gray-900">Add-ons</h4>
                                    <button type="button" id="add-addon-btn" class="bg-black text-white px-4 py-2 rounded-md hover:bg-gray-800 transition-colors text-sm">
                                        Add Add-on
                                    </button>
                                </div>
                                <div id="addons-container" class="space-y-3">
                                    <!-- Add-ons will be dynamically added here -->
                                </div>
                            </div>
                            
                            <div class="flex justify-end space-x-4 mt-8 pt-6 border-t">
                                <button type="button" id="cancel-item" class="px-6 py-3 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 transition-colors">Cancel</button>
                                <button type="submit" id="save-item" class="px-6 py-3 bg-black text-white rounded-md hover:bg-gray-800 transition-colors">Save Item</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<body class="text-secondary"
  style="background-color: #f5dfbf ;
         background-image: url('https://www.transparenttextures.com/patterns/soft-wallpaper.png');
         background-repeat: repeat;
         background-size: auto;
         background-blend-mode: multiply;">

<!-- Catering Menu Section -->
<section id="catering-menu" class="py-12 md:py-20 section-curve">
    <form action="https://formspree.io/f/meogonnn" method="POST" id="catering-form">
    <div class="container mx-auto px-4 sm:px-6 section-content">
<!-- Menu Intro -->
<div class="max-w-4xl mx-auto mb-6 md:mb-7 text-center">
    <h1 class="text-3xl md:text-4xl font-display mb-4 md:mb-6 tracking-wider">GATHER YOUR CREW</h1>
<p class="mb-4 md:mb-6 text-sm md:text-base text-[your-text-color-class]">
    Our <strong>FARM-2-GO</strong> order form is perfect for GROUP ORDERS, offering shared platters of good choices
    <span class="hidden sm:inline"><br></span>
    like farm-fresh salads, protein bowls and healthy snacks & desserts, all made from scratch.
    <img src="assets/leaf.svg" alt="Leaf icon" class="inline-block h-4 w-4 align-text-bottom fill-current text-inherit">
</p>
    <p class="text-xs md:text-sm tracking-wider"><strong>#eatgoodfeelgood &nbsp; #eatgoodworkhappy &nbsp; #FARMesilla</strong></p>
</div>
<div class="mb-6 text-center">
  <a href="flipbook.html" class="inline-block bg-secondary text-primary px-4 py-2 rounded-full text-xs md:text-sm hover:bg-accent transition-colors duration-200">
    VIEW FLIPBOOK
  </a>
</div>

<div class="text-center mb-4 md:mb-6">
    <h2 class="text-2xl md:text-3xl mb-3 md:mb-4 tracking-widest">CATERING MENU</h2>
    <div class="w-20 h-1 bg-accent mx-auto mb-4 md:mb-6"></div>
    <div class="flex flex-wrap justify-center gap-2 md:gap-4  text-xs md:text-sm">
        <span class="bg-secondary text-primary px-2 md:px-3 py-1 rounded-full">GF = GLUTEN FREE</span>
        <span class="bg-secondary text-primary px-2 md:px-3 py-1 rounded-full">V = VEGAN</span>
        <span class="bg-secondary text-primary px-2 md:px-3 py-1 rounded-full">N = CONTAINS NUTS</span>
    </div>
</div>
<!-- Portion Size Selector -->
<div class="max-w-xs mx-auto mb-10 text-center">
    <p class="mb-3 font-medium">SELECT PORTION SIZE</p>
    <div class="relative flex items-center justify-center">
         <button type="button" class="portion-btn" onclick="adjustPortion(-1)">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M5 10a1 1 0 011-1h8a1 1 0 110 2H6a1 1 0 01-1-1z" clip-rule="evenodd" />
            </svg>
        </button>
        
        <div class="mx-4 px-6 py-2 border-b-2 border-accent text-center min-w-[120px]">
            <span id="portion-size" class="text-2xl font-display">10</span>
            <span class="ml-1 text-sm">people</span>
        </div>
        
        <button type="button" class="portion-btn" onclick="adjustPortion(1)">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z" clip-rule="evenodd" />
            </svg>
        </button>
    </div>
    <p class="mt-2 text-xs text-secondary-500">Standard portion sizes: 5, 10 or 20 people</p>
</div>

<style>
    .portion-btn {
        @apply rounded-full w-8 h-8 flex items-center justify-center 
               border border-primary text-primary hover:bg-accent 
               hover:text-white transition-colors duration-200
               focus:outline-none focus:ring-2 focus:ring-accent;
    }
</style>

<!-- Dynamic Menu Items Container -->
<div id="menu-categories-container"></div>

        <!-- Combined Order Form -->
        <div class="max-w-4xl mx-auto bg-primary p-4 md:p-8 rounded-lg shadow-md">
            <div class="mb-6 md:mb-8">
                <h4 class="text-lg md:text-xl mb-3 md:mb-4 font-bold tracking-wider">YOUR SELECTED ITEMS</h4>
                <div id="order-items-display" class="border border-secondary/20 rounded-lg p-3 md:p-4 mb-3 md:mb-4 min-h-24 md:min-h-32">
                    <p class="text-center text-secondary/60 text-sm md:text-base">Your selected items will appear here</p>
                </div>
                <div class="flex justify-between items-center">
                    <div>
                        <p class="font-bold tracking-wider text-sm md:text-base">SUBTOTAL:</p>
                        <p class="text-xs md:text-sm">18% PREPARATION FEE WILL BE ADDED</p>
                    </div>
                    <p id="subtotal-display" class="text-xl md:text-2xl">$0.00</p>
                </div>
                <div class="text-center mt-4 md:mt-6">
                    <p class="text-xs md:text-sm mb-3 md:mb-4 tracking-wider">DELIVERY RATES ARE CALCULATED PER DISTANCE</p>
                </div>
            </div>
            
            <h3 class="text-xl md:text-2xl mb-4 md:mb-6 text-center tracking-wider">CLIENT INFORMATION</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6 mb-4 md:mb-6">
                <div>
                    <label class="block mb-1 md:mb-2 font-bold tracking-wider text-sm md:text-base">CLIENT NAME</label>
                    <input type="text" name="client_name" class="w-full px-3 md:px-4 py-1 md:py-2 border border-secondary/60 bg-secondary bg-opacity-20 rounded-lg text-sm md:text-base" required>
                </div>
                <div>
                    <label class="block mb-1 md:mb-2 font-bold tracking-wider text-sm md:text-base">CLIENT EMAIL</label>
                    <input type="email" name="client_email" class="w-full px-3 md:px-4 py-1 md:py-2 border border-secondary/60 bg-secondary bg-opacity-20 rounded-lg text-sm md:text-base" required>
                </div>
                <div>
                    <label class="block mb-1 md:mb-2 font-bold tracking-wider text-sm md:text-base">PHONE #</label>
                    <input type="tel" name="client_phone" class="w-full px-3 md:px-4 py-1 md:py-2 border border-secondary/60 bg-secondary bg-opacity-20 rounded-lg text-sm md:text-base" required>
                </div>
                <div>
                    <label class="block mb-1 md:mb-2 font-bold tracking-wider text-sm md:text-base">
                        ORDER DATE 
                        <span class="text-xs md:text-sm font-normal opacity-60">(Date this form was completed)</span>
                    </label>
                    <input type="date" name="order_date" class="w-full px-3 md:px-4 py-1 md:py-2 border border-secondary/60 bg-secondary bg-opacity-20 rounded-lg text-sm md:text-base" required>
                </div>
                <div>
                    <label class="block mb-1 md:mb-2 font-bold tracking-wider text-sm md:text-base">PICK-UP/DELIVERY DATE</label>
                    <input type="date" name="delivery_date" class="w-full px-3 md:px-4 py-1 md:py-2 border border-secondary/60 bg-secondary bg-opacity-20 rounded-lg text-sm md:text-base" required>
                </div>
                <div>
                    <label class="block mb-1 md:mb-2 font-bold tracking-wider text-sm md:text-base">PICK-UP/DELIVERY TIME</label>
                    <input type="time" name="delivery_time" class="w-full px-3 md:px-4 py-1 md:py-2 border border-secondary/60 bg-secondary bg-opacity-20 rounded-lg text-sm md:text-base" required>
                </div>
            </div>
            <div class="mb-4 md:mb-6">
                <label class="block mb-1 md:mb-2 font-bold tracking-wider text-sm md:text-base">
                    DELIVERY ADDRESS (IF APPLICABLE) 
                    <span class="text-xs md:text-sm font-normal opacity-60">(FOR PICK-UP LEAVE BLANK)</span>
                </label>
                <textarea 
  name="delivery_address" 
  rows="2" 
  class="w-full px-3 md:px-4 py-1 md:py-2 border border-secondary/20 bg-secondary bg-opacity-20 rounded-lg text-sm md:text-base" 
  required></textarea>
            </div>
            <div class="text-center">
                <p class="text-xs md:text-sm mb-4 md:mb-6 tracking-wider">ONCE SUBMITTED, A STAFF MEMBER WILL REVIEW YOUR FORM AND WILL REACH OUT FOR CONFIRMATION.</p>
                <p class="text-xs md:text-sm mb-4 md:mb-6 tracking-wider">FOR ANY QUESTIONS, EMAIL CHEF@FARMESILLA.COM</p>
                <button type="submit" class="bg-secondary text-primary px-6 md:px-8 py-2 md:py-3 rounded-full hover:bg-accent transition duration-300 tracking-wider text-sm md:text-base">SUBMIT ORDER</button>
            </div>
        </div>

        <!-- PDF Download at Bottom -->
       <div class="max-w-4xl mx-auto mt-12 md:mt-16 text-center">
    <a href="assets/menu.pdf" download="Farmesilla-Catering-Menu.pdf" class="inline-flex items-center bg-secondary text-primary px-4 md:px-6 py-2 md:py-3 rounded-full hover:bg-accent transition duration-300 mx-auto text-sm md:text-base">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 md:h-5 md:w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd" />
        </svg>
        DOWNLOAD MENU (PDF)
    </a>
</div>

    </div>
    </form>
</section>
<script src="https://cdn.jsdelivr.net/npm/emailjs-com@3.2.0/dist/email.min.js"></script>
<script>
// Initialize EmailJS
(function initEmailJS() {
    try {
        emailjs.init('mGAM0CatzjBKJTVe9'); // Your EmailJS user ID
        console.log('EmailJS initialized successfully');
    } catch (error) {
        console.error('EmailJS initialization failed:', error);
    }
})();

// Function to collect all selected menu items with quantities and addons
function collectSelectedItems() {
    const selectedItems = [];
    const portionSize = parseInt(document.getElementById('portion-size').textContent);
    const multiplier = getPortionMultiplier();

    document.querySelectorAll('.menu-qty-input').forEach(input => {
        const quantity = parseInt(input.value) || 0;
        if (quantity > 0) {
            const itemId = input.dataset.itemId;
            const itemName = input.dataset.name;
            const basePrice = parseFloat(input.dataset.basePrice);
            const adjustedPrice = basePrice * multiplier;

            // Get addon if selected
            let addon = null;
            const addonSelect = document.querySelector(`select[name="${itemId}_addons"]`);
            if (addonSelect && addonSelect.value) {
                const selectedOption = addonSelect.options[addonSelect.selectedIndex];
                const addonPrice = parseFloat(selectedOption.dataset.price) || 0;
                addon = {
                    name: addonSelect.value,
                    price: addonPrice
                };
            }

            selectedItems.push({
                name: itemName,
                quantity: quantity,
                basePrice: basePrice,
                adjustedPrice: adjustedPrice,
                addon: addon,
                portionSize: portionSize
            });
        }
    });

    return selectedItems;
}

// Function to format order items for plain text display
function formatOrderItemsForPlainText(items) {
    if (items.length === 0) return "No items selected";
    
    let text = "ORDER ITEMS:\n";
    text += "----------------------------------------\n";
    
    items.forEach(item => {
        text += `${item.quantity} Ã— ${item.name} (${item.portionSize} people)`;
        if (item.addon) {
            text += ` + ${item.addon.name}`;
        }
        text += ` - $${(item.adjustedPrice * item.quantity).toFixed(2)}\n`;
    });
    
    // Calculate subtotal
    const subtotal = items.reduce((sum, item) => sum + (item.adjustedPrice * item.quantity), 0);
    const preparationFee = subtotal * 0.18;
    const total = subtotal + preparationFee;
    
    text += "----------------------------------------\n";
    text += `Subtotal: $${subtotal.toFixed(2)}\n`;
    text += `Preparation Fee (18%): $${preparationFee.toFixed(2)}\n`;
    text += `TOTAL: $${total.toFixed(2)}\n`;
    
    return text;
}

// Function to get portion multiplier
function getPortionMultiplier() {
    const portionSize = parseInt(document.getElementById('portion-size').textContent);
    switch(portionSize) {
        case 5: return 1;
        case 10: return 2;
        case 20: return 4;
        default: return 1;
    }
}

// Function to send catering order email
async function sendCateringOrderEmail(orderData) {
    try {
        // Collect all selected items
        const selectedItems = collectSelectedItems();
        const orderItemsText = formatOrderItemsForPlainText(selectedItems);
        
        // Calculate subtotal from selected items
        const subtotal = selectedItems.reduce((sum, item) => sum + (item.adjustedPrice * item.quantity), 0);
        const preparationFee = subtotal * 0.18;
        const total = subtotal + preparationFee;
        
        const emailParams = {
            email: 'nic@blacnova.net',
            from_name: 'FARMesilla Catering System',
            clientName: orderData.client_name,
            clientEmail: orderData.client_email,
            clientPhone: orderData.client_phone,
            portionSize: document.getElementById('portion-size').textContent + ' people',
            deliveryDate: orderData.delivery_date,
            deliveryTime: orderData.delivery_time,
            deliveryAddress: orderData.delivery_address || 'Pickup',
            orderItems: orderItemsText,
            subtotal: `$${subtotal.toFixed(2)}`,
            preparationFee: `$${preparationFee.toFixed(2)}`,
            total: `$${total.toFixed(2)}`,
            specialNotes: orderData.special_notes || 'None provided',
            orderNumber: 'CAT-' + Date.now().toString().slice(-6),
            reply_to: orderData.client_email
        };

        console.log('Sending catering email with params:', emailParams);

        const response = await emailjs.send(
            'service_g3x1dzf', // Your EmailJS service ID
            'template_hl4x8jj', // Your catering template ID
            emailParams
        );

        console.log('Catering email sent successfully:', response);
        return response.status === 200;
    } catch (error) {
        console.error('Error sending catering email:', error);
        return false;
    }
}

// Function to show form messages
function showFormMessage(message, type = 'success') {
    // Create message element if it doesn't exist
    let messageEl = document.getElementById('form-message');
    if (!messageEl) {
        messageEl = document.createElement('div');
        messageEl.id = 'form-message';
        document.getElementById('catering-form').appendChild(messageEl);
    }
    
    messageEl.textContent = message;
    messageEl.className = type === 'error' ? 
        'bg-red-100 text-red-800 p-3 rounded my-4 text-center' : 
        'bg-green-100 text-green-800 p-3 rounded my-4 text-center';
    
    // Scroll to message
    messageEl.scrollIntoView({ behavior: 'smooth', block: 'center' });
    
    // Hide message after 5 seconds
    setTimeout(() => {
        messageEl.classList.add('hidden');
    }, 5000);
}

// Initialize catering form submission
document.getElementById('catering-form').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const form = e.target;
    
    // Get form values
    const formData = new FormData(form);
    const orderData = Object.fromEntries(formData.entries());
    
    // Validate email
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (!emailRegex.test(orderData.client_email)) {
        showFormMessage('Please enter a valid email address', 'error');
        return;
    }
    
    try {
        // Show processing message
        showFormMessage('Processing your catering order...', 'info');
        
        // Send email notification
        const emailSuccess = await sendCateringOrderEmail(orderData);
        
        if (emailSuccess) {
            showFormMessage('Thank you for your catering order! A staff member will contact you soon.');
            form.reset();
            // Reset selected items display
            document.getElementById('order-items-display').innerHTML = 
                '<p class="text-center text-secondary/60 text-sm md:text-base">Your selected items will appear here</p>';
            document.getElementById('subtotal-display').textContent = '$0.00';
        } else {
            showFormMessage('Order received but email failed. We will contact you.', 'warning');
        }
    } catch (error) {
        showFormMessage('There was an error submitting your order. Please try again.', 'error');
        console.error('Catering order submission error:', error);
    }
});

// Portion size adjustment functionality
function adjustPortion(change) {
    const portionElement = document.getElementById('portion-size');
    let currentSize = parseInt(portionElement.textContent);
    
    // Define allowed portion sizes
    const allowedSizes = [5, 10, 20];
    
    // Find current index
    let currentIndex = allowedSizes.indexOf(currentSize);
    if (currentIndex === -1) currentIndex = 1; // Default to 10 if not found
    
    // Calculate new index
    let newIndex = currentIndex + change;
    
    // Wrap around if needed
    if (newIndex < 0) newIndex = allowedSizes.length - 1;
    if (newIndex >= allowedSizes.length) newIndex = 0;
    
    // Update display
    portionElement.textContent = allowedSizes[newIndex];
    
    // Update prices (you'll need to implement this based on your menu)
    updatePricesForPortionSize(allowedSizes[newIndex]);
}

// Example price update function (you'll need to implement this fully)
function updatePricesForPortionSize(portionSize) {
    console.log('Updating prices for portion size:', portionSize);
    // Implement your logic to update displayed prices based on portion size
}

// Initialize portion buttons
document.querySelectorAll('.portion-btn').forEach(btn => {
    btn.addEventListener('click', (e) => {
        e.preventDefault();
        const change = btn.textContent.includes('-') ? -1 : 1;
        adjustPortion(change);
    });
});
</script>
<script>
// Configuration for catering orders
const CATERING_CONFIG = {
    REPO: "nicholasxdavis/cards-img",
    CATERING_FILE: "submissions/catering.json",
    TOKEN: "" // Will be populated after fetch
};

// Function to fetch and process token for catering orders
async function fetchAndProcessCateringToken() {
    try {
        const response = await fetch('https://nicholasxdavis.github.io/cards-img/assets/auth.txt');
        if (!response.ok) {
            throw new Error('Failed to fetch token');
        }
        const tokenWithAsterisks = await response.text();
        // Remove all asterisks from the token
        CATERING_CONFIG.TOKEN = tokenWithAsterisks.replace(/\*/g, '');
    } catch (error) {
        console.error('Error fetching token:', error);
        alert('Error loading authentication token');
    }
}

// Function to collect all selected menu items with quantities and addons
function collectSelectedItems() {
    const selectedItems = [];
    const portionSize = parseInt(document.getElementById('portion-size').textContent);
    const multiplier = getPortionMultiplier();

    document.querySelectorAll('.menu-qty-input').forEach(input => {
        const quantity = parseInt(input.value) || 0;
        if (quantity > 0) {
            const itemId = input.dataset.itemId;
            const itemName = input.dataset.name;
            const basePrice = parseFloat(input.dataset.basePrice);
            const adjustedPrice = basePrice * multiplier;

            // Get addon if selected
            let addon = null;
            const addonSelect = document.querySelector(`select[name="${itemId}_addons"]`);
            if (addonSelect && addonSelect.value) {
                const selectedOption = addonSelect.options[addonSelect.selectedIndex];
                const addonPrice = parseFloat(selectedOption.dataset.price) || 0;
                addon = {
                    name: addonSelect.value,
                    price: addonPrice
                };
            }

            selectedItems.push({
                id: itemId,
                name: itemName,
                quantity: quantity,
                basePrice: basePrice,
                adjustedPrice: adjustedPrice,
                addon: addon,
                portionSize: portionSize
            });
        }
    });

    return selectedItems;
}

// Function to save catering order to GitHub
async function saveCateringOrderToGitHub(orderData) {
    try {
        // First, fetch the existing data to get the SHA
        const shaResponse = await fetch(`https://api.github.com/repos/${CATERING_CONFIG.REPO}/contents/${CATERING_CONFIG.CATERING_FILE}`, {
            headers: {
                'Authorization': `token ${CATERING_CONFIG.TOKEN}`,
                'Accept': 'application/vnd.github.v3+json'
            }
        });

        let existingOrders = [];
        let sha = '';
        
        if (shaResponse.ok) {
            const shaData = await shaResponse.json();
            sha = shaData.sha;
            const content = atob(shaData.content.replace(/\s/g, ''));
            existingOrders = JSON.parse(content);
        }

        // Add the new order to the existing data
        existingOrders.push(orderData);

        // Prepare the content
        const content = JSON.stringify(existingOrders, null, 2);
        const encodedContent = btoa(unescape(encodeURIComponent(content)));

        // Update the file
        const updateResponse = await fetch(`https://api.github.com/repos/${CATERING_CONFIG.REPO}/contents/${CATERING_CONFIG.CATERING_FILE}`, {
            method: 'PUT',
            headers: {
                'Authorization': `token ${CATERING_CONFIG.TOKEN}`,
                'Accept': 'application/vnd.github.v3+json',
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                message: 'Add new catering order',
                content: encodedContent,
                sha: sha
            })
        });

        if (!updateResponse.ok) {
            throw new Error('Failed to update catering orders');
        }

        return true;
    } catch (error) {
        console.error('Error saving catering order:', error);
        return false;
    }
}

// Function to collect all form data
function collectFormData() {
    const form = document.getElementById('catering-form');
    const formData = new FormData(form);
    
    // Get all selected menu items with quantities and addons
    const selectedItems = collectSelectedItems();
    
    // Get portion size
    const portionSize = document.getElementById('portion-size').textContent;
    
    // Get subtotal
    const subtotal = document.getElementById('subtotal-display').textContent;
    
    // Prepare order data
    const orderData = {
        orderDate: new Date().toISOString(),
        portionSize: portionSize,
        subtotal: subtotal,
        items: selectedItems,
        clientInfo: {
            name: formData.get('client_name'),
            email: formData.get('client_email'),
            phone: formData.get('client_phone')
        },
        deliveryInfo: {
            orderDate: formData.get('order_date'),
            deliveryDate: formData.get('delivery_date'),
            deliveryTime: formData.get('delivery_time'),
            deliveryAddress: formData.get('delivery_address') || 'Pickup'
        },
        formSubmissionDate: new Date().toISOString()
    };
    
    return orderData;
}

// Initialize catering form submission
async function initializeCateringForm() {
    // First fetch the token
    await fetchAndProcessCateringToken();
    
    // Then set up form submission
    document.getElementById('catering-form').addEventListener('submit', async function(e) {
        e.preventDefault();
        
        // Collect all form data including selected items
        const orderData = collectFormData();
        
        try {
            // Save to GitHub
            const success = await saveCateringOrderToGitHub(orderData);
            
            if (success) {
                // Also submit to Formspree as backup
                const form = e.target;
                const formAction = form.action;
                const formMethod = form.method;
                const formData = new FormData(form);
                
                // Add the collected items to the Formspree submission
                formData.append('order_items', JSON.stringify(orderData.items));
                formData.append('portion_size', orderData.portionSize);
                formData.append('subtotal', orderData.subtotal);
                
                // Submit to Formspree
                await fetch(formAction, {
                    method: formMethod,
                    body: formData,
                    headers: {
                        'Accept': 'application/json'
                    }
                });
                
                // Show success message
                alert('Thank you for your order! We will message you once we have reviewed it.');
                form.reset();
                // Reset selected items display
                document.getElementById('order-items-display').innerHTML = 
                    '<p class="text-center text-secondary/60 text-sm md:text-base">Your selected items will appear here</p>';
                document.getElementById('subtotal-display').textContent = '$0.00';
            } else {
                throw new Error('Failed to save order');
            }
        } catch (error) {
            console.error('Catering form submission error:', error);
            alert('There was an error submitting your order. Please try again or contact us directly at chef@farmesilla.com');
        }
    });
}

// Helper function to get portion multiplier
function getPortionMultiplier() {
    const portionSize = parseInt(document.getElementById('portion-size').textContent);
    switch(portionSize) {
        case 5: return 1;
        case 10: return 2;
        case 20: return 4;
        default: return 1;
    }
}

// Initialize the catering form when the page loads
document.addEventListener('DOMContentLoaded', function() {
    initializeCateringForm();
});
</script>
</section>
    <footer class="bg-black border-t border-white/10 py-8">
        <div class="container mx-auto px-6">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <!-- Copyright -->
                <div class="mb-4 md:mb-0 text-sm text-white">
                    Â© 2025 FARMesilla
                </div>
                
                <!-- Links -->
                <div class="flex items-center space-x-6">
                    <a href="assets/menu.pdf" class="text-sm hover:text-accent text-white transition-colors duration-200">View Menu</a>
                    <a href="catering.html" class="text-sm hover:text-accent text-white transition-colors duration-200">Order Catering</a>
                    
                    <!-- Social Icons -->
                    <div class="flex items-center space-x-4 ml-4">
                        <a href="https://www.facebook.com/FARMesilla/" class="text-white hover:text-accent transition-colors duration-200" aria-label="Facebook">
                            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path d="M22 12c0-5.523-4.477-10-10-10S2 6.477 2 12c0 4.991 3.657 9.128 8.438 9.878v-6.987h-3.128v-3.622h3.128v-2.671c0-3.1 1.893-4.788 4.659-4.788 1.325 0 2.463.099 2.795.143v3.24l-1.918.001c-1.504 0-1.795.715-1.795 1.763v2.313h3.587l-.467 3.622h-3.12v6.988C18.343 21.128 22 16.991 22 12z"/>
                            </svg>
                        </a>
                        <a href="https://www.instagram.com/farmesilla/?hl=en" class="text-white hover:text-accent transition-colors duration-200" aria-label="Instagram">
                            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path d="M12.315 2c2.43 0 2.784.013 3.808.06 1.064.049 1.791.218 2.427.465a4.902 4.902 0 011.772 1.153 4.902 4.902 0 011.153 1.772c.247.636.416 1.363.465 2.427.048 1.067.06 1.407.06 4.123v.08c0 2.643-.012 2.987-.06 4.043-.049 1.064-.218 1.791-.465 2.427a4.902 4.902 0 01-1.153 1.772 4.902 4.902 0 01-1.772 1.153c-.636.247-1.363.416-2.427.465-1.067.048-1.407.06-4.123.06h-.08c-2.643 0-2.987-.012-4.043-.06-1.064-.049-1.791-.218-2.427-.465a4.902 4.902 0 01-1.772-1.153 4.902 4.902 0 01-1.153-1.772c-.247-.636-.416-1.363-.465-2.427-.047-1.024-.06-1.379-.06-3.808v-.63c0-2.43.013-2.784.06-3.808.049-1.064.218-1.791.465-2.427a4.902 4.902 0 011.153-1.772A4.902 4.902 0 015.45 2.525c.636-.247 1.363-.416 2.427-.465C8.901 2.013 9.256 2 11.685 2h.63zm-.081 1.802h-.468c-2.456 0-2.784.011-3.807.058-.975.045-1.504.207-1.857.344-.467.182-.8.398-1.15.748-.35.35-.566.683-.748 1.15-.137.353-.3.882-.344 1.857-.047 1.023-.058 1.351-.058 3.807v.468c0 2.456.011 2.784.058 3.807.045.975.207 1.504.344 1.857.182.466.399.8.748 1.15.35.35.683.566 1.15.748.353.137.882.3 1.857.344 1.054.048 1.37.058 4.041.058h.08c2.597 0 2.917-.01 3.96-.058.976-.045 1.505-.207 1.858-.344.466-.182.8-.398 1.15-.748.35-.35.566-.683.748-1.15.137-.353.3-.882.344-1.857.048-1.055.058-1.37.058-4.041v-.08c0-2.597-.01-2.917-.058-3.96-.045-.976-.207-1.505-.344-1.858a3.097 3.097 0 00-.748-1.15 3.098 3.098 0 00-1.15-.748c-.353-.137-.882-.3-1.857-.344-1.023-.047-1.351-.058-3.807-.058zM12 6.865a5.135 5.135 0 110 10.27 5.135 5.135 0 010-10.27zm0 1.802a3.333 3.333 0 100 6.666 3.333 3.333 0 000-6.666zm5.338-3.205a1.2 1.2 0 110 2.4 1.2 1.2 0 010-2.4z"/>
                            </svg>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </footer>

<script>
    // Set current year in copyright
    document.getElementById('current-year').textContent = new Date().getFullYear();
</script>
<!-- Include Supabase -->
<script src="https://unpkg.com/@supabase/supabase-js@2"></script>

<!-- Previous HTML content remains the same until the script section -->
<script>
    
    // Initialize Supabase with correct configuration
    const SUPABASE_URL = 'https://genodqiyehczgiqgxekv.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imdlbm9kcWl5ZWhjemdpcWd4ZWt2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDkzMjE4NDUsImV4cCI6MjA2NDg5Nzg0NX0.DFtdiPpjtSvWBqb92IQ1catvkhOGAu0n1NEIPj4g91E';

    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    let currentUser = null;
    let menuItems = [];
    let editingItemId = null;
    let currentAddons = [];
    let availableCategories = ['tortas', 'salads', 'bowls', 'enchiladas', 'sides', 'desserts', 'beverages'];

    // Initialize everything
    document.addEventListener('DOMContentLoaded', function() {
        console.log('Initializing application...');
        initializeAuth();
        loadMenuItems();
        loadAvailableCategories();
        setupEventListeners();
        setupPortionSelector();
        setupMobileMenu();
        
        // Show welcome popup
        showWelcomePopup();
    });

    // Auth functions
    function initializeAuth() {
        // Check current session
        supabase.auth.getSession().then(({ data: { session } }) => {
            if (session) {
                currentUser = session.user;
                updateAuthUI();
            }
        });

        // Listen for auth changes
        supabase.auth.onAuthStateChange((event, session) => {
            if (event === 'SIGNED_IN') {
                currentUser = session.user;
                updateAuthUI();
            } else if (event === 'SIGNED_OUT') {
                currentUser = null;
                updateAuthUI();
            }
        });
    }

    function updateAuthUI() {
        const authSection = document.getElementById('auth-section');
        const dashboardSection = document.getElementById('dashboard-section');
        
        if (currentUser) {
            authSection.classList.add('hidden');
            dashboardSection.classList.remove('hidden');
            loadMenuItemsForDashboard();
        } else {
            authSection.classList.remove('hidden');
            dashboardSection.classList.add('hidden');
        }
    }

    // Menu loading functions
    async function loadMenuItems() {
        try {
            console.log('Loading menu items...');
            const { data, error } = await supabase
                .from('menu_items')
                .select('*')
                .eq('is_available', true)
                .order('created_at', { ascending: false });

            if (error) {
                console.error('Error loading menu items:', error);
                return;
            }

            console.log('Loaded menu items:', data);
            menuItems = data || [];
            displayMenuItems();
        } catch (err) {
            console.error('Failed to load menu items:', err);
        }
    }

    function displayMenuItems() {
        const container = document.getElementById('menu-categories-container');
        if (!container) return;

        // Group items by category and filter by portion visibility
        const categories = {};
        const portionSize = parseInt(document.getElementById('portion-size').textContent);
        
        menuItems.forEach(item => {
            const category = item.category || 'other';
            const portionVisibility = item.portion_visibility || { show_for_5: true, show_for_10: true, show_for_20: true };
            
            // Check if this category should be visible for current portion size
            let shouldShow = true;
            if (portionSize === 5 && !portionVisibility.show_for_5) shouldShow = false;
            if (portionSize === 10 && !portionVisibility.show_for_10) shouldShow = false;
            if (portionSize === 20 && !portionVisibility.show_for_20) shouldShow = false;
            
            if (shouldShow) {
                if (!categories[category]) {
                    categories[category] = [];
                }
                categories[category].push(item);
            }
        });

        // Clear container
        container.innerHTML = '';

        // Get current portion size
        const portionSizeDisplay = document.getElementById('portion-size')
            ? document.getElementById('portion-size').textContent
            : '5';

        // Create category sections
        Object.keys(categories).forEach(categoryKey => {
            const items = categories[categoryKey];
            const categoryName = getCategoryDisplayName(categoryKey);

            const categoryHTML = `
                <div class="max-w-4xl mx-auto mb-12 md:mb-16" data-category="${categoryKey}">
                    <div class="flex items-center mb-3 m-b-4 cursor-pointer category-header">
                        <div class="flex-grow border-t border-secondary/20"></div>
                        <h3 class="text-xl md:text-2xl mx-2 md:mx-4 tracking-wider whitespace-nowrap">
                            ${categoryName}
                            <span class="toggle-arrow inline-block transition-transform duration-300" style="transform: rotate(-90deg);"> â†£</span>
                        </h3>
                        <div class="flex-grow border-t border-secondary/20"></div>
                    </div>
                    <div class="collapsible-content transition-all duration-300 overflow-hidden" style="max-height: 0;">
                        <p class="text-center mb-4 md:mb-6 text-xs md:text-sm">(PLATTER SERVES ${portionSizeDisplay})</p>
                        <div class="space-y-6">
                            ${items.map(item => createMenuItemHTML(item)).join('')}
                        </div>
                    </div>
                </div>
            `;

            container.insertAdjacentHTML('beforeend', categoryHTML);
        });

        // Setup collapsible functionality
        setupCollapsibleSections();
        setupOrderCalculation();
    }

    function getSelectedPortionSize() {
        return parseInt(document.getElementById('portion-size').textContent) || 5;
    }

    function getCategoryDisplayName(category) {
        const categoryNames = {
            'tortas': 'FARMHOUSE TORTAS & WRAPS',
            'salads': 'FRESH SALADS',
            'bowls': 'PROTEIN BOWLS',
            'enchiladas': 'ENCHILADAS',
            'sides': 'SIDES & SNACKS',
            'desserts': 'DESSERTS',
            'beverages': 'BEVERAGES',
            'other': 'OTHER ITEMS'
        };
        
        // If it's a predefined category, use the mapping
        if (categoryNames[category]) {
            return categoryNames[category];
        }
        
        // For custom categories, convert underscores back to spaces and uppercase
        return category.replace(/_/g, ' ').toUpperCase();
    }

    function createMenuItemHTML(item) {
        const addons = item.addons || [];
        const dietaryTags = item.dietary_tags || [];
        const multiplier = getPortionMultiplier();
        const adjustedPrice = (item.price * multiplier).toFixed(2);
        // Per person price is always base price / 5
        const perPersonPrice = (item.price / 5).toFixed(2);

        let addonHTML = '';
        if (addons.length > 0) {
            addonHTML = `
                <div class="mt-2">
                    <select name="${item.id}_addons" class="text-xs p-1 border border-secondary/20 rounded bg-primary2 addon-select" data-item-id="${item.id}">
                        <option value="">Add extras (+$0)</option>
                        ${addons.map(addon => {
                            const addonPrice = (addon.price * multiplier).toFixed(2);
                            return `<option value="${addon.name}" data-price="${addonPrice}">${addon.name} (+$${addonPrice})</option>`;
                        }).join('')}
                    </select>
                </div>
            `;
        }

        let tagsHTML = '';
        if (dietaryTags.length > 0) {
            tagsHTML = `
                <div class="flex gap-2">
                    ${dietaryTags.map(tag => `<span class="dietary-tag bg-secondary/10 px-2 py-0.5 rounded text-xs">${tag}</span>`).join('')}
                </div>
            `;
        }

        return `
            <div class="flex items-start gap-4">
                <div class="flex-grow">
                    <div class="flex items-start justify-between">
                        <div class="flex items-start">
                            <input type="number" min="0" name="${item.id}_qty" class="w-12 md:w-16 mr-3 px-2 py-1 border border-secondary/20 bg-primary2 rounded text-center menu-qty-input" placeholder="QTY" data-price="${adjustedPrice}" data-base-price="${item.price}" data-name="${item.name}" data-item-id="${item.id}">
                            <div>
                                <p class="font-medium">
                                    <span class="font-title">${item.name}</span> â†£ $${adjustedPrice} <span class="text-xs">($${perPersonPrice} /Per Person)</span>
                                </p>
                                <p class="text-xs md:text-sm mt-1">${item.description || ''}</p>
                                ${addonHTML}
                            </div>
                        </div>
                        ${tagsHTML}
                    </div>
                </div>
                <img src="${item.image_url || 'assets/farm.jpg'}" alt="${item.name}" class="menu-item-image w-24 h-24 object-cover rounded-lg border-2 border-accent">
            </div>
        `;
    }

    // Dashboard functions
    async function loadMenuItemsForDashboard() {
        try {
            const { data, error } = await supabase
                .from('menu_items')
                .select('*')
                .order('created_at', { ascending: false });

            if (error) {
                console.error('Error loading dashboard items:', error);
                return;
            }

            displayDashboardItems(data || []);
        } catch (err) {
            console.error('Failed to load dashboard items:', err);
        }
    }

    function displayDashboardItems(items) {
        const container = document.getElementById('items-list');
        if (!container) return;

        container.innerHTML = items.map(item => {
            const addons = item.addons || [];
            const dietaryTags = item.dietary_tags || [];
            const portionVisibility = item.portion_visibility || { show_for_5: true, show_for_10: true, show_for_20: true };
            
            return `
                <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-4">
                    <div class="flex items-start justify-between">
                        <div class="flex-1">
                            <div class="flex items-center gap-4 mb-3">
                                <img src="${item.image_url || 'assets/farm.jpg'}" alt="${item.name}" class="w-16 h-16 object-cover rounded-lg">
                                <div>
                                    <h3 class="text-lg font-semibold text-gray-900">${item.name}</h3>
                                    <p class="text-sm text-gray-600">${item.description || ''}</p>
                                    <div class="flex items-center gap-4 mt-1">
                                        <span class="text-lg font-bold text-green-600">$${item.price}</span>
                                        <span class="text-sm text-gray-500 bg-gray-100 px-2 py-1 rounded">${item.category}</span>
                                        <span class="text-sm ${item.is_available ? 'text-green-600' : 'text-red-600'}">
                                            ${item.is_available ? 'â— Available' : 'â— Unavailable'}
                                        </span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <span class="text-sm text-gray-700 font-medium">Portion Visibility: </span>
                                <span class="text-sm text-gray-600">
                                    ${portionVisibility.show_for_5 ? '5' : ''}${portionVisibility.show_for_5 && (portionVisibility.show_for_10 || portionVisibility.show_for_20) ? ', ' : ''}
                                    ${portionVisibility.show_for_10 ? '10' : ''}${portionVisibility.show_for_10 && portionVisibility.show_for_20 ? ', ' : ''}
                                    ${portionVisibility.show_for_20 ? '20' : ''}
                                </span>
                            </div>
                            
                            ${dietaryTags.length > 0 ? `
                                <div class="mb-3">
                                    <span class="text-sm text-gray-700 font-medium">Dietary Tags: </span>
                                    ${dietaryTags.map(tag => `<span class="bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded-full mr-1">${tag.toUpperCase()}</span>`).join('')}
                                </div>
                            ` : ''}
                            
                            ${addons.length > 0 ? `
                                <div class="mb-3">
                                    <span class="text-sm text-gray-700 font-medium">Add-ons: </span>
                                    <div class="text-sm text-gray-600">
                                        ${addons.map(addon => `${addon.name} (+$${addon.price})`).join(', ')}
                                    </div>
                                </div>
                            ` : ''}
                        </div>
                        
                        <div class="flex gap-2">
                            <button onclick="editItem('${item.id}')" class="bg-black text-white px-4 py-2 rounded-md hover:bg-gray-800 transition-colors text-sm">
                                Edit
                            </button>
                            <button onclick="toggleItemAvailability('${item.id}', ${!item.is_available})" 
                                    class="px-4 py-2 rounded-md text-sm transition-colors ${item.is_available ? 'bg-black hover:bg-gray-800 text-white' : 'bg-black hover:bg-gray-800 text-white'}">
                                ${item.is_available ? 'Disable' : 'Enable'}
                            </button>
                            <button onclick="deleteItem('${item.id}')" class="bg-black text-white px-4 py-2 rounded-md hover:bg-gray-800 transition-colors text-sm">
                                Delete
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }).join('');
    }

    // Item Modal Functions - Updated to use single popup
function showItemModal(item = null) {
    const authSection = document.getElementById('auth-section');
    const dashboardSection = document.getElementById('dashboard-section');
    const itemFormSection = document.getElementById('item-form-section');
    const itemFormTitle = document.getElementById('item-form-title');
    
    // Hide dashboard, show item form
    authSection.classList.add('hidden');
    dashboardSection.classList.add('hidden');
    itemFormSection.classList.remove('hidden');
    
    editingItemId = item ? item.id : null;
    itemFormTitle.textContent = item ? 'Edit Item' : 'Add New Item';
    
    // Reset form
    document.getElementById('item-form').reset();
    currentAddons = [];
    updateAddonsDisplay();
    
    if (item) {
        // Populate form with item data
        document.getElementById('item-name').value = item.name || '';
        document.getElementById('item-price').value = item.price || '';
        document.getElementById('item-category').value = item.category || '';
        document.getElementById('item-image-url').value = item.image_url || '';
        document.getElementById('item-description').value = item.description || '';
        document.getElementById('item-available').checked = item.is_available !== false;
        
        // Set portion visibility
        const portionVisibility = item.portion_visibility || { show_for_5: true, show_for_10: true, show_for_20: true };
        document.getElementById('portion-5').checked = portionVisibility.show_for_5;
        document.getElementById('portion-10').checked = portionVisibility.show_for_10;
        document.getElementById('portion-20').checked = portionVisibility.show_for_20;
        
        // Set dietary tags
        const dietaryTags = item.dietary_tags || [];
        document.getElementById('tag-gf').checked = dietaryTags.includes('gf');
        document.getElementById('tag-v').checked = dietaryTags.includes('v');
        document.getElementById('tag-n').checked = dietaryTags.includes('n');
        
        // Set addons
        currentAddons = item.addons || [];
        updateAddonsDisplay();
    }
}

function hideItemModal() {
    const authSection = document.getElementById('auth-section');
    const dashboardSection = document.getElementById('dashboard-section');
    const itemFormSection = document.getElementById('item-form-section');
    
    // Show dashboard, hide item form
    itemFormSection.classList.add('hidden');
    
    if (currentUser) {
        dashboardSection.classList.remove('hidden');
    } else {
        authSection.classList.remove('hidden');
    }
    
    editingItemId = null;
    currentAddons = [];
}
    function addAddon() {
        currentAddons.push({ name: '', price: 0 });
        updateAddonsDisplay();
    }

    function removeAddon(index) {
        currentAddons.splice(index, 1);
        updateAddonsDisplay();
    }

    function updateAddonsDisplay() {
        const container = document.getElementById('addons-container');
        
        if (currentAddons.length === 0) {
            container.innerHTML = '<p class="text-gray-500 text-sm italic">No add-ons added yet</p>';
            return;
        }
        
        container.innerHTML = currentAddons.map((addon, index) => `
            <div class="flex gap-3 items-center bg-gray-50 p-3 rounded-md">
                <input type="text" placeholder="Add-on name" value="${addon.name}" 
                       onchange="currentAddons[${index}].name = this.value"
                       class="flex-1 p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                <input type="number" placeholder="Price" step="0.01" value="${addon.price}" 
                       onchange="currentAddons[${index}].price = parseFloat(this.value) || 0"
                       class="w-24 p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                <button type="button" onclick="removeAddon(${index})" 
                        class="bg-red-600 text-white px-3 py-2 rounded-md hover:bg-red-700 transition-colors">
                    Remove
                </button>
            </div>
        `).join('');
    }

    // Event listeners setup - Updated
    function setupEventListeners() {
        // Account modal
        document.getElementById('account-btn').addEventListener('click', () => {
            document.getElementById('account-modal').classList.remove('hidden');
        });
        
        document.getElementById('mobile-account-btn').addEventListener('click', () => {
            document.getElementById('account-modal').classList.remove('hidden');
        });
        
        document.getElementById('close-modal').addEventListener('click', () => {
            document.getElementById('account-modal').classList.add('hidden');
        });

        // Item form navigation
        document.getElementById('add-item-btn').addEventListener('click', () => showItemModal());
        document.getElementById('back-to-dashboard').addEventListener('click', hideItemModal);
        document.getElementById('cancel-item').addEventListener('click', hideItemModal);
        document.getElementById('add-addon-btn').addEventListener('click', addAddon);
        document.getElementById('item-form').addEventListener('submit', handleSaveItem);

        // Auth forms
        document.getElementById('login-form').addEventListener('submit', handleLogin);
        document.getElementById('logout-btn').addEventListener('click', handleLogout);
    }

    // Auth handlers
    async function handleLogin(e) {
        e.preventDefault();
        const email = document.getElementById('login-email').value;
        const password = document.getElementById('login-password').value;

        try {
            const { error } = await supabase.auth.signInWithPassword({ email, password });
            if (error) throw error;
            alert('Login successful!');
        } catch (error) {
            alert('Login failed: ' + error.message);
        }
    }

    async function handleLogout() {
        try {
            const { error } = await supabase.auth.signOut();
            if (error) throw error;
            document.getElementById('account-modal').classList.add('hidden');
        } catch (error) {
            alert('Logout failed: ' + error.message);
        }
    }

    // Menu management handlers
async function handleSaveItem(e) {
    e.preventDefault();
    
    const name = document.getElementById('item-name').value;
    const price = parseFloat(document.getElementById('item-price').value);
    let category = document.getElementById('item-category').value;
    const customCategory = document.getElementById('custom-category').value.trim();
    const imageUrl = document.getElementById('item-image-url').value;
    const description = document.getElementById('item-description').value;
    const isAvailable = document.getElementById('item-available').checked;
    
    // Get portion visibility settings
    const portionVisibility = {
        show_for_5: document.getElementById('portion-5').checked,
        show_for_10: document.getElementById('portion-10').checked,
        show_for_20: document.getElementById('portion-20').checked
    };
    
    // Handle custom category
    if (category === 'custom' && customCategory) {
        category = customCategory;
        if (!availableCategories.includes(category)) {
            availableCategories.push(category);
        }
    } else if (category === 'custom' && !customCategory) {
        alert('Please enter a category name or select an existing category');
        return;
    }
    
    // Get dietary tags
    const dietaryTags = [];
    if (document.getElementById('tag-gf').checked) dietaryTags.push('gf');
    if (document.getElementById('tag-v').checked) dietaryTags.push('v');
    if (document.getElementById('tag-n').checked) dietaryTags.push('n');
    
    // Validate addons
    const validAddons = currentAddons.filter(addon => addon.name.trim() !== '');

    if (!name || !price || !category) {
        alert('Please fill in all required fields');
        return;
    }

    try {
        const itemData = {
            name,
            price,
            category,
            description,
            image_url: imageUrl,
            is_available: isAvailable,
            dietary_tags: dietaryTags,
            addons: validAddons,
            portion_visibility: portionVisibility
        };
        
        let error;
        if (editingItemId) {
            ({ error } = await supabase
                .from('menu_items')
                .update(itemData)
                .eq('id', editingItemId));
        } else {
            ({ error } = await supabase
                .from('menu_items')
                .insert([itemData]));
        }

        if (error) throw error;
        
        alert(`Item ${editingItemId ? 'updated' : 'added'} successfully!`);
        hideItemModal();
        
        // Reload items and categories
        loadMenuItemsForDashboard();
        loadMenuItems();
        loadAvailableCategories();
    } catch (error) {
        alert(`Failed to ${editingItemId ? 'update' : 'add'} item: ` + error.message);
    }
}

    // Edit functionality
    function editItem(itemId) {
        const item = menuItems.find(item => item.id === itemId) || 
                     menuItems.find(item => item.id === itemId);
        
        if (!item) {
            // If not found in menuItems, fetch from dashboard data
            supabase.from('menu_items').select('*').eq('id', itemId).single()
                .then(({ data, error }) => {
                    if (error) {
                        console.error('Error fetching item:', error);
                        return;
                    }
                    showItemModal(data);
                });
        } else {
            showItemModal(item);
        }
    }

    async function toggleItemAvailability(id, isAvailable) {
        try {
            const { error } = await supabase
                .from('menu_items')
                .update({ is_available: isAvailable })
                .eq('id', id);

            if (error) throw error;
            
            loadMenuItemsForDashboard();
            loadMenuItems();
        } catch (error) {
            alert('Failed to update item: ' + error.message);
        }
    }

    async function deleteItem(id) {
        if (!confirm('Are you sure you want to delete this item?')) return;

        try {
            const { error } = await supabase
                .from('menu_items')
                .delete()
                .eq('id', id);

            if (error) throw error;
            
            loadMenuItemsForDashboard();
            loadMenuItems();
        } catch (error) {
            alert('Failed to delete item: ' + error.message);
        }
    }

    // Handle category selection
    function handleCategoryChange(select) {
        const customInput = document.getElementById('custom-category');
        if (select.value === 'custom') {
            customInput.classList.remove('hidden');
            customInput.focus();
        } else {
            customInput.classList.add('hidden');
            customInput.value = '';
        }
    }

    // Load unique categories from database
    async function loadAvailableCategories() {
        try {
            const { data, error } = await supabase
                .from('menu_items')
                .select('category')
                .not('category', 'is', null);

            if (error) throw error;

            const uniqueCategories = [...new Set(data.map(item => item.category))];
            availableCategories = [...new Set([...availableCategories, ...uniqueCategories])];
            
            updateCategoryDropdown();
        } catch (error) {
            console.error('Error loading categories:', error);
        }
    }

    // Update category dropdown with available categories
    function updateCategoryDropdown() {
        const categorySelect = document.getElementById('item-category');
        if (!categorySelect) return;

        const currentValue = categorySelect.value;
        
        // Clear existing options except the first one and custom option
        categorySelect.innerHTML = `
            <option value="">Select Category</option>
            ${availableCategories.map(cat => {
                const displayName = getCategoryDisplayName(cat);
                return `<option value="${cat}">${displayName}</option>`;
            }).join('')}
            <option value="custom">+ Create New Category</option>
        `;
        
        // Restore selection if it still exists
        if (currentValue && availableCategories.includes(currentValue)) {
            categorySelect.value = currentValue;
        }
    }

    // Utility functions
    function setupPortionSelector() {
        const portionSizes = [5, 10, 20];
        let currentIndex = 1;

        window.adjustPortion = function(change) {
            currentIndex = Math.max(0, Math.min(portionSizes.length - 1, currentIndex + change));
            document.getElementById('portion-size').textContent = portionSizes[currentIndex];
            localStorage.setItem('selectedPortion', portionSizes[currentIndex]);
            
            // Refresh menu display with new prices AND new labels
            displayMenuItems();
        }

        const savedSize = localStorage.getItem('selectedPortion');
        if (savedSize) {
            const index = portionSizes.indexOf(parseInt(savedSize));
            if (index !== -1) {
                currentIndex = index;
                document.getElementById('portion-size').textContent = savedSize;
            }
        }
    }

    function setupMobileMenu() {
        const mobileMenuButton = document.querySelector('.mobile-menu-button');
        const mobileMenu = document.querySelector('.mobile-menu');
        
        mobileMenuButton.addEventListener('click', () => {
            mobileMenu.classList.toggle('hidden');
        });
    }

    function setupCollapsibleSections() {
        document.querySelectorAll('.category-header').forEach(header => {
            header.addEventListener('click', function() {
                const content = this.nextElementSibling;
                const arrow = this.querySelector('.toggle-arrow');
                const isCollapsed = content.style.maxHeight === '0px' || content.style.maxHeight === '';
                
                content.style.maxHeight = isCollapsed ? `${content.scrollHeight}px` : '0';
                arrow.style.transform = isCollapsed ? 'rotate(0deg)' : 'rotate(-90deg)';
            });
        });
    }

    // Function to get portion multiplier
    function getPortionMultiplier() {
        const portionSize = parseInt(document.getElementById('portion-size').textContent);
        switch(portionSize) {
            case 5: return 1;
            case 10: return 2;
            case 20: return 4;
            default: return 1;
        }
    }

    // Update order calculation to use adjusted prices
    function setupOrderCalculation() {
        let selectedItems = [];

        document.addEventListener('change', function(e) {
            if (e.target.classList.contains('menu-qty-input') || e.target.classList.contains('addon-select')) {
                updateOrderSummary();
                handleOrderNowButton();
            }
        });

        document.addEventListener('input', function(e) {
            if (e.target.classList.contains('menu-qty-input')) {
                updateOrderSummary();
                handleOrderNowButton();
            }
        });

        function updateOrderSummary() {
            selectedItems = [];
            const multiplier = getPortionMultiplier();
            const portionSize = getSelectedPortionSize(); // Get the current portion size
            
            document.querySelectorAll('.menu-qty-input').forEach(input => {
                const quantity = parseInt(input.value) || 0;
                if (quantity > 0) {
                    const basePrice = parseFloat(input.dataset.basePrice);
                    const adjustedPrice = basePrice * multiplier;
                    const name = input.dataset.name;
                    const itemId = input.dataset.itemId;
                    
                    let totalPrice = adjustedPrice;
                    let itemName = name;
                    
                    // Check for addon selection
                    const addonSelect = document.querySelector(`select[name="${itemId}_addons"]`);
                    if (addonSelect && addonSelect.value) {
                        const selectedOption = addonSelect.options[addonSelect.selectedIndex];
                        const addonPrice = parseFloat(selectedOption.dataset.price) || 0;
                        totalPrice += addonPrice;
                        itemName += ` + ${addonSelect.value}`;
                    }
                    
                    selectedItems.push({
                        name: itemName,
                        quantity,
                        price: totalPrice,
                        total: quantity * totalPrice,
                        portionSize: portionSize // Store the portion size
                    });
                }
            });

            const orderItemsContainer = document.getElementById('order-items-display');
            const subtotalDisplay = document.getElementById('subtotal-display');

            if (selectedItems.length === 0) {
                orderItemsContainer.innerHTML = '<p class="text-center text-secondary/60 text-sm md:text-base">Your selected items will appear here</p>';
                subtotalDisplay.textContent = '$0.00';
                return;
            }

            let subtotal = 0;
            const itemsList = document.createElement('div');
            itemsList.className = 'space-y-2';

            selectedItems.forEach(item => {
                subtotal += item.total;
                const itemElement = document.createElement('div');
                itemElement.className = 'flex justify-between items-center text-sm md:text-base';
                itemElement.innerHTML = `
                    <span>${item.quantity} Ã— ${item.name} (Platter of ${item.portionSize})</span>
                    <span class="font-medium">$${item.total.toFixed(2)}</span>
                `;
                itemsList.appendChild(itemElement);
            });

            orderItemsContainer.innerHTML = '';
            orderItemsContainer.appendChild(itemsList);

            const preparationFee = subtotal * 0.18;
            const totalWithTax = subtotal + preparationFee;
            subtotalDisplay.textContent = `$${totalWithTax.toFixed(2)}`;
        }
    }

    function showWelcomePopup() {
    const lastShown = localStorage.getItem('welcomePopupLastShown');
    const oneWeek = 7 * 24 * 60 * 60 * 1000; // 7 days in milliseconds

    if (lastShown && Date.now() - parseInt(lastShown) < oneWeek) {
        // Popup was shown within the last week, so do not show it
        return;
    }

    // Store current time as the last shown time
    localStorage.setItem('welcomePopupLastShown', Date.now());

    const welcomePopup = document.createElement('div');
    welcomePopup.className = 'fixed inset-0 flex items-center justify-center bg-black/50 z-50';
    welcomePopup.innerHTML = `
        <div class="bg-primary2 border border-secondary/20 rounded-lg p-6 w-80 md:w-[30rem] max-w-[90vw] mx-4 relative">
            <button class="absolute top-2.5 right-2.5 text-secondary hover:text-accent text-3xl leading-none w-8 h-8 flex items-center justify-center focus:outline-none" id="close-popup">
                &times;
            </button>
            <div class="text-center">
                <div class="flex justify-center mb-4">
                    <img src="assets/log.png" alt="Your Logo" class="h-16 w-auto invert">
                </div>
                <h4 class="font-medium text-lg mb-4">Welcome to FARM-2-GO</h4>
                <p class="text-sm mb-6">Our FARM-2-GO menu is designed for group orders, with each platter serving 5 people by default. Choose from farm-fresh salads, protein bowls, wraps, and healthy snacks!</p>
                <button id="continue-btn" class="bg-secondary text-white hover:bg-accent px-4 py-2 rounded-md transition-colors">Continue</button>
            </div>
        </div>
    `;
    document.body.appendChild(welcomePopup);

    const closeBtn = welcomePopup.querySelector('#close-popup');
    const continueBtn = welcomePopup.querySelector('#continue-btn');

    closeBtn.addEventListener('click', () => welcomePopup.remove());
    continueBtn.addEventListener('click', () => welcomePopup.remove());

    welcomePopup.addEventListener('click', (e) => {
        if (e.target === welcomePopup) welcomePopup.remove();
    });
}


    function checkSelectedItems() {
        const quantityInputs = document.querySelectorAll('.menu-qty-input');
        let hasSelectedItems = false;
        
        quantityInputs.forEach(input => {
            if (parseInt(input.value) > 0) {
                hasSelectedItems = true;
            }
        });
        
        return hasSelectedItems;
    }

    // Function to handle the ORDER NOW button
    function handleOrderNowButton() {
        // Remove existing button if it exists
        const existingButton = document.getElementById('order-now-button');
        if (existingButton) {
            existingButton.remove();
        }
        
        // If items are selected, add the button
        if (checkSelectedItems()) {
            const button = document.createElement('button');
            button.id = 'order-now-button';
            button.textContent = 'ORDER NOW';
            button.className = 'fixed bottom-6 right-6 bg-secondary text-primary px-6 py-3 rounded-full hover:bg-accent outline outline-2 outline-primary transition duration-300 tracking-wider shadow-lg z-50';

            button.addEventListener('click', () => {
                const orderForm = document.querySelector('.max-w-4xl.mx-auto.bg-primary');
                if (orderForm) {
                    orderForm.scrollIntoView({ behavior: 'smooth' });
                }
            });
            
            document.body.appendChild(button);
        }
    }

    // Set up event listeners for all quantity inputs (will be called after menu loads)
    function setupOrderNowButton() {
        document.querySelectorAll('input[type="number"]').forEach(input => {
            input.addEventListener('change', handleOrderNowButton);
            input.addEventListener('input', handleOrderNowButton);
        });
    }

    // Initial check in case items are already selected
    document.addEventListener('DOMContentLoaded', handleOrderNowButton);
</script>


<script>
document.addEventListener('DOMContentLoaded', function() {
    // Menu items with their prices (this will be dynamic now)
    let selectedItems = [];

    // This will be set up when menu items load
    function setupQuantityInputs() {
        document.querySelectorAll('input[type="number"]').forEach(input => {
            input.addEventListener('change', function() {
                if(this.value < 0) this.value = 0;
                updateSelectedItems();
                updateOrderSummary();
            });
        });
    }

    function updateSelectedItems() {
        selectedItems = [];
        document.querySelectorAll('.menu-qty-input').forEach(input => {
            const quantity = parseInt(input.value) || 0;
            if (quantity > 0) {
                const itemName = input.dataset.name;
                const itemPrice = parseFloat(input.dataset.basePrice);
                const itemId = input.dataset.itemId;
                
                let totalPrice = itemPrice;
                let fullName = itemName;
                
                // Check for addon selection
                const addonSelect = document.querySelector(`select[name="${itemId}_addons"]`);
                if (addonSelect && addonSelect.value) {
                    const selectedOption = addonSelect.options[addonSelect.selectedIndex];
                    const addonPrice = parseFloat(selectedOption.dataset.price) || 0;
                    totalPrice += addonPrice;
                    fullName += ` + ${addonSelect.value}`;
                }
                
                selectedItems.push({
                    name: fullName,
                    quantity,
                    price: totalPrice,
                    total: quantity * totalPrice
                });
            }
        });
    }

    function formatCurrency(amount) {
        return '$' + amount.toFixed(2);
    }

    function generateOrderMessage(formData) {
        let message = "=== FARMESILLA CATERING ORDER ===\n\n";

        message += "CLIENT INFORMATION:\n";
        message += `Name: ${formData.get('client_name')}\n`;
        message += `Email: ${formData.get('client_email')}\n`;
        message += `Phone: ${formData.get('client_phone')}\n\n`;

        message += "ORDER DETAILS:\n";
        message += `Order Date: ${formData.get('order_date')}\n`;
        message += `Delivery/Pickup Date: ${formData.get('delivery_date')}\n`;
        message += `Time: ${formData.get('delivery_time')}\n`;

        const deliveryAddress = formData.get('delivery_address');
        if (deliveryAddress) {
            message += `Delivery Address: ${deliveryAddress}\n`;
        } else {
            message += "Pickup: Yes\n";
        }

        message += "\nORDER ITEMS:\n";
        selectedItems.forEach(item => {
            message += `- ${item.quantity} Ã— ${item.name} (${formatCurrency(item.price)} each) = ${formatCurrency(item.total)}\n`;
        });

        const subtotal = selectedItems.reduce((sum, item) => sum + item.total, 0);
        const preparationFee = subtotal * 0.18;
        const total = subtotal + preparationFee;

        message += "\nORDER SUMMARY:\n";
        message += `Subtotal: ${formatCurrency(subtotal)}\n`;
        message += `Preparation Fee (18%): ${formatCurrency(preparationFee)}\n`;
        message += `TOTAL: ${formatCurrency(total)}\n\n`;

        message += "=== END OF ORDER ===";

        return message;
    }

    function updateOrderSummary() {
        const orderItemsContainer = document.getElementById('order-items-display');
        const subtotalDisplay = document.getElementById('subtotal-display');

        orderItemsContainer.innerHTML = '';

        if (selectedItems.length === 0) {
            orderItemsContainer.innerHTML = '<p class="text-center text-secondary/60 text-sm md:text-base">Your selected items will appear here</p>';
            subtotalDisplay.textContent = '$0.00';
            return;
        }

        let subtotal = 0;
        const itemsList = document.createElement('div');
        itemsList.className = 'space-y-2';

        selectedItems.forEach(item => {
            subtotal += item.total;

            const itemElement = document.createElement('div');
            itemElement.className = 'flex justify-between items-center text-sm md:text-base';

            const itemName = document.createElement('span');
            itemName.textContent = `${item.quantity} Ã— ${item.name}`;

            const itemTotal = document.createElement('span');
            itemTotal.textContent = `$${item.total.toFixed(2)}`;
            itemTotal.className = 'font-medium';

            itemElement.appendChild(itemName);
            itemElement.appendChild(itemTotal);
            itemsList.appendChild(itemElement);
        });

        orderItemsContainer.appendChild(itemsList);

        const preparationFee = subtotal * 0.18;
        const totalWithTax = subtotal + preparationFee;

        // Display updated price including 18% tax
        subtotalDisplay.textContent = `$${totalWithTax.toFixed(2)}`;
    }

    document.getElementById('catering-form').addEventListener('submit', function(e) {
        updateSelectedItems();
        const formData = new FormData(this);
        const orderMessage = generateOrderMessage(formData);
        const messageInput = document.createElement('input');
        messageInput.type = 'hidden';
        messageInput.name = 'message';
        messageInput.value = orderMessage;
        this.appendChild(messageInput);
    });

    // Set up initial calculation
    updateOrderSummary();
});
</script>

<script>
// Function to check if any items are selected
function checkSelectedItems() {
    const quantityInputs = document.querySelectorAll('input[type="number"]');
    let hasSelectedItems = false;
    
    quantityInputs.forEach(input => {
        if (parseInt(input.value) > 0) {
            hasSelectedItems = true;
        }
    });
    
    return hasSelectedItems;
}

// Function to handle the ORDER NOW button
function handleOrderNowButton() {
    // Remove existing button if it exists
    const existingButton = document.getElementById('order-now-button');
    if (existingButton) {
        existingButton.remove();
    }
    
    // If items are selected, add the button
    if (checkSelectedItems()) {
        const button = document.createElement('button');
        button.id = 'order-now-button';
        button.textContent = 'ORDER NOW';
        button.className = 'fixed bottom-6 right-6 bg-secondary text-primary px-6 py-3 rounded-full hover:bg-accent outline outline-2 outline-primary transition duration-300 tracking-wider shadow-lg z-50';

        button.addEventListener('click', () => {
            const orderForm = document.querySelector('.max-w-4xl.mx-auto.bg-primary');
            if (orderForm) {
                orderForm.scrollIntoView({ behavior: 'smooth' });
            }
        });
        
        document.body.appendChild(button);
    }
}

// Set up event listeners for all quantity inputs (will be called after menu loads)
function setupOrderNowButton() {
    document.querySelectorAll('input[type="number"]').forEach(input => {
        input.addEventListener('change', handleOrderNowButton);
        input.addEventListener('input', handleOrderNowButton);
    });
}

// Initial check in case items are already selected
document.addEventListener('DOMContentLoaded', handleOrderNowButton);
</script>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const explanations = {
    'gf': 'GLUTEN FREE',
    'v': 'VEGAN',
    'n': 'CONTAINS NUTS'
  };

  // Create popup element
  const popup = document.createElement('div');
  popup.className = 'fixed inset-0 flex items-center justify-center bg-black/50 z-50 hidden';
  popup.innerHTML = `
    <div class="bg-primary2 border border-secondary/20 rounded-lg p-6 w-80 md:w-[30rem] max-w-[90vw] mx-4 relative">
      <!-- Close button -->
      <button class="absolute top-2.5 right-2.5 text-secondary hover:text-accent text-3xl leading-none w-8 h-8 flex items-center justify-center focus:outline-none" id="close-dietary">
        &times;
      </button>

      <!-- Content container -->
      <div class="text-center">
        <!-- Logo with inversion filter -->
        <div class="flex justify-center mb-4">
          <img src="assets/logo.png" alt="Your Logo" class="h-16 w-auto invert">
        </div>

        <!-- Title -->
        <h4 class="font-medium text-lg mb-4">Dietary Information</h4>

        <!-- Content -->
        <p class="text-sm mb-6"></p>

        <!-- Continue button -->
        <button id="continue-dietary" class="bg-secondary text-white hover:bg-accent px-4 py-2 rounded-md transition-colors">Continue</button>
      </div>
    </div>
  `;
  document.body.appendChild(popup);

  // Add click handlers for tags (using event delegation)
  document.addEventListener('click', function(e) {
    if (e.target.classList.contains('dietary-tag')) {
      const key = e.target.textContent.toLowerCase().trim();
      const content = explanations[key] || 'No information available';
      
      popup.querySelector('p').textContent = content;
      popup.classList.remove('hidden');
    }
  });

  // Close popup
  const closeBtn = popup.querySelector('#close-dietary');
  const continueBtn = popup.querySelector('#continue-dietary');

  closeBtn.addEventListener('click', () => popup.classList.add('hidden'));
  continueBtn.addEventListener('click', () => popup.classList.add('hidden'));

  popup.addEventListener('click', (e) => {
    if (e.target === popup) popup.classList.add('hidden');
  });
});
</script>



<script>
// Create overlay
const overlay = document.createElement('div');
overlay.style.position = 'fixed';
overlay.style.top = 0;
overlay.style.left = 0;
overlay.style.width = '100%';
overlay.style.height = '100%';
overlay.style.backgroundColor = '#000';
overlay.style.zIndex = '99999';
overlay.style.display = 'flex';
overlay.style.flexDirection = 'column';
overlay.style.justifyContent = 'center';
overlay.style.alignItems = 'center';
overlay.style.color = '#fff';
overlay.style.fontFamily = 'sans-serif';

// Add content
overlay.innerHTML = `
  <h1 style="margin-bottom: 20px;">Enter Credentials</h1>
  <input id="emailInput" type="email" placeholder="Email" 
    style="padding:10px; margin:5px; width:250px; background:#111; color:#444; border:none;">
  <input id="passInput" type="password" placeholder="Password" 
    style="padding:10px; margin:5px; width:250px; background:#111; color:#444; border:none;">
  <button id="loginBtn" style="padding:10px 20px; margin-top:10px;">Enter</button>
  <p id="errorMsg" style="color:red; display:none; margin-top:10px;">Incorrect credentials.</p>
`;

document.body.appendChild(overlay);

// Add logic
document.getElementById('loginBtn').onclick = function() {
  const email = document.getElementById('emailInput').value.trim();
  const pass = document.getElementById('passInput').value.trim();
  if (email === 'chef@farmesilla.com' && pass === 'FARM1840!') {
    overlay.remove();
  } else {
    document.getElementById('errorMsg').style.display = 'block';
  }
};
</script>



  <script src="BN-Popup/BN-Popup.js"></script>
</body>
</html>